const selectors = ".footer > #cookie-law-info-bar, .small.cookie-consent, .left.udc-holder, .yellow.rgpd, .container > #cookie-law-info-bar, .container.cookieinfo, .container ~ div[data-react-class=\"CookieAgree\"], .cookiebar:not(body):not(html), .bottom.cookie__section, .navbar > .CookieConsent, .fs-cc-banner_component, .сookieAgreement, cookie-header, dcinfo_cookie_agb, gdpr-notice, [aria-describedby=\"cookie-information\"], [aria-describedby=\"cookieprivacy\"], [aria-describedby=\"cookies-policy-message\"], [aria-describedby=\"dialog-eu-cookie-law\"], [aria-describedby^=\"cookie-wall-\"], [aria-label=\"Consent Banner\"], [aria-labelledby=\"cookie-dialog\"], [aria-labelledby=\"cookie-wall-heading\"], [aria-labelledby=\"ui-dialog-title-cookiebox\"], [cnn-cookie-policy], [cookie-unique-name], [data-alert-cookie], [data-at-selector=\"cookie-banner\"], [data-automation=\"cookies-banner\"], [data-behaviour=\"cookie-popup\"], [data-bind=\"visible: showCookieWarning\"], [data-ccpa], [data-cookie-disclaimer], [data-cookie-name=\"cookiesDirective\"], [data-cookie-number], [data-cookie-validity-days], [data-cookie=\"uso-accept-cookies\"], [data-cookie^=\"cookie.disclaimer\"], [data-cvent-id=\"cookie-banner\"], [data-cy=\"cookie-banner\"], [data-dmid*=\"cookiebar-\"], [data-dmscookie], [data-g-name=\"CookieBanner\"], [data-gaoop_hide_after_close], [data-inc=\"cookies\"], [data-include=\"cookie\"], [data-include=\"cookies\"], [data-key=\"cookies-warning\"], [data-module=\"CookieBanner\"], [data-module=\"cookies\"], [data-name=\"cookieNotice\"], [data-name^=\"CookiesNotification\"], [data-notification=\"CookiePolicyAgreement\"], [data-popmake*=\"cookie_\"], [data-qa=\"CookieBar\"], [data-qa=\"txtGdprCookiePopup\"], [data-react-class*=\"CookieConsentBanner\"], [data-react-class=\"EUCookieBanner\"], [data-ref=\"cookies\"], [data-rgpd-inc], [data-role=\"cookie-notice\"], [data-s-type=\"cookie-message\"], [data-selector=\"cookie-policy\"], [data-target=\"coockie\"], [data-test-id=\"CookiePopup\"], [data-test-id=\"cookie-consent-banner\"], [data-test=\"cookie-banner\"], [data-test=\"gdpr-cookies-popup\"], [data-test=\"gdpr-modal\"], [data-testid=\"accept-cookies-banner\"], [data-testid=\"cookie-bar\"], [data-testid=\"cookie-policy\"], [data-testid=\"cookieBanner-widget\"], [data-testid=\"cookieConsentBanner\"], [data-testid=\"cookienotice-container\"], [data-testid=\"cookies_footer\"], [data-testid=\"main-cookies-banner-container\"], [data-token=\"gdpr_cookie_notice\"], [data-type=\"cookie-addsense\"], [data-unique-cookie-name], [data-veci=\"cookies-policy\"], [data-view-name=\"privacy-updated-notice\"], [href=\"https://devowl.io/wordpress-real-cookie-banner/\"], [href=\"javascript: Cookiebot.renew()\"], [id=\"lux-cookie-dialog\"], [name=\"cookie-info\"], [name=\"cookiewarning\"], [ng-controller=\"CookieBannerCtrl\"], [ng-show^=\"cookiePolicyCtrl\"], [type=\"cookie-notification\"], [x-data=\"cookieBanner()\"], [x-show=\"showCookieConsent\"], accept-cookie-box, acidjs-xcookie-consent, adcookies, alterdata-cookie-tool, amedia-privacybox, amp-consent, amp-user-notification, app-accept-cookie, app-aviso-cookie, app-aviso-cookies, app-banner[arialabel*=\"Cookies\"], app-ccpa-banner, app-cookie, app-cookie-banner, app-cookie-bar, app-cookie-consent, app-cookie-consent-banner, app-cookie-consent-feature, app-cookie-consent-modal, app-cookie-consent-popup, app-cookie-info, app-cookie-msg, app-cookie-notification, app-cookie-policy, app-cookie-popup, app-cookie-prompt, app-cookie-rules, app-cookie-warning, app-cookies, app-cookies-agreement, app-cookies-alert, app-cookies-banner, app-cookies-box, app-cookies-confirm, app-cookies-consent, app-cookies-modal, app-cookies-notice, app-cookies-policy, app-cookies-policy-updated, app-cookies-popup, app-cookies-toast, app-foncia-cookie-banner, app-rodo, ark-cookiebar, aside[class=\"rgpd\"], atlas-logon-cookie-policy, avis-cookies, awsui-alert[dismiss*=\"CookieBanner\"], aza-cookie-message, b2c-cookies-notification, browser-login-cookie-notification, c-community-cookie-consent-banner, c-cookie-consent, c-ecp-cookies-banner, cbn-cookies, cg-cookies-banner, cloudflare-app[app=\"cookiless\"], cloudflare-app[app=\"tibrr-cookie-consent\"], cmm-cookie-banner, cmpviews-cookies-accept, cn-cookie-agreement, col-cookie-info-banner, comply-consent-manager, con-cookie-popup, consent, consent-notification, cook-disclaimer, cookie-agreement-block, cookie-alert, cookie-banner, cookie-bar, cookie-confirmation, cookie-consent, cookie-consent-banner, cookie-consent-component, cookie-drawer-policy, cookie-info, cookie-law-banner, cookie-modal, cookie-notice, cookie-notification, cookie-permission, cookie-policy, cookie-policy-popin, cookie-popup, cookie-warning, cookie-wrap, cookie_notice, cookiebox, cookies-consent, cookies-gdpr, cookies-hint, cookies-notification, cookies-overlay, cookies-policy, cookies-popup, cookies-requirement, cookies-warning, cookiless-div, cru-cookie-policy, cts-disclaimer-cookies, dayaway-cookie-consent, dile-cookies-consent, div[data-automation=\"cookies-banner\"], div[data-automation=\"privacy-banner-wrapper\"], div[data-banner=\"cookies\"], div[data-borlabs-cookie-wrap], div[data-box-name=\"cookie policy\"], div[data-cmp-no-consent], div[data-component=\"cookie-policy\"], div[data-component=\"cookieContent\"], div[data-components=\"pdr-ws1lib-header\"], div[data-container-acceptcookies], div[data-cookie-law-banner-selector], div[data-cookie-notification], div[data-cookie-path], div[data-cookie-policy-modal], div[data-cookie-warning], div[data-cookiebanner], div[data-cookiebar], div[data-cookielayer-init], div[data-corgi-component=\"cookie-banner\"], div[data-etsy-promo-cookie-expires], div[data-gdpr-consent-prompt], div[data-id=\"cookieBar\"], div[data-id=\"cookie_dialog\"], div[data-is-cookieinfo], div[data-module=\"cookie_banner\"], div[data-notificationid=\"cookie\"], div[data-pnp-mi-id=\"mi-cookies\"], div[data-pov-accept-cookies-message], div[data-privacy-consent], div[data-react-class=\"CookieNotice\"], div[data-role=\"cookie-policy-banner\"], div[data-section-type=\"CookiesBanner\"], div[data-selector=\"container@cookiebar\"], div[data-selen-group=\"cookies-bar\"], div[data-selenium=\"CookieBanner\"], div[data-test-sell-cookie-banner], div[data-test=\"cookie-policy-banner\"], div[data-testid=\"cookie-disclaimer\"], div[data-testid=\"cookie-policy-banner\"], div[data-wzb=\"CookieNotification\"], div[element-structure-cookiemonster], div[js-cookies], div[ld-scope=\"cookie-consent\"], div[ng-click=\"self.setCookieDisclaimer()\"], div[spec=\"cookie-disclaimer\"], dk-cookie-warning, dva-m-cookie-flyout, ea-truste-consent-bar, edn-cookie, emv-anonymous-consent-management-banner, eo-cookie-bar, epaas-consent-drawer-shell, esn-cookie-disclaimer, eu-cookie-compliance, fab-cookie-control-banner2, fdp-widget-cookie-consent, form[name=\"FormLeggeCookies\"], g-cookie-policy, gdpr-age-consent-modal, gdpr-consent, gdpr-cookies, gdpr-policies, gdprpopupmod, gfp-cookie-policy-notice, gj-cookie-prompt, hma-cookie-notification, idg-cookie-info-bar, ing-ui-rba-cookie, ir-cookie-consent, jsa-cookie, kuma-cookie-bar, lgpd-cookie, lgpd-cookie-terms, lib-privacy-policy-toast, lnb-cookie-policy-overlay, loop-cookie, luno-cookie-preferences, m-cookies-notice, mct-templater-cookie-consent, mip-cookie-info, n9-disclaimer-cookies, nges-cookie-notification, nl-cookie-notice, nosid-cookie-banner, ns-cookie-privacy-tip, o-cookie-law, ocaso-global-modal, oct-cookie-consent, ods-accept-cookies-message, of-cookies-notice, ofi-cookie-box-widget, onl-cookie, outer-wrapper-cookie, pd-cookie-banner, pdo-cookies-policy, policy-consent, pp-cookie-dialog, privacy-policy-toast, proactua-cookie-consent, puma-cookie-banner, rtk-cookies-notice, s72-cookie-consent, sd-cookies-widget, section[class*=\"_CookieNotice\"], section[data-component=\"Com3Cookie\"], section[data-test-id=\"cookie-notice\"], section[data-view=\"cookiePolicy\"], sell-cookie-banner, shb-cookie-accept, shb-cookie-consent, sibbo-cmp-layout, sj-cookie-banner, son-cookie-consent, staedtler-cookie-banner, suchen-cookie-privacy-toast, tag-cookie-banner, thor-cookies, thread-cookie-notice, ts-cookie-msg, tui-cookie-bar, tui-cookie-consent, tuugo-notification, uc-cookie-notification, ugc-cookie-banner, ux-cookie-layer, vc-site-cookiepolicy-dialog, veiss-cookies, vls-cookie-banner, voc-cookie-warning, wc-cookies, web-cookie-consent, wecoma-lite, wieland-cookie-banner, wp-cookie-notification-banner, wx-cookie-policy-notification, xk-cookie-policy-warning, yd-cookie-notice, yg-cookie-confirm, ytd-consent-bump-renderer, ytd-mealbar-promo-renderer, ytg-notification-footer, zapf-cookie-banner, [class^=\"cookieBox-\"], div[style*=\"box-shadow: rgb(136, 136, 136) 0px 0px 12px; color: \"], lyxor-cookies-disclaimer, app-root app-cookie-acceptance, ytd-app ~ iron-overlay-backdrop"
var websocket;
var banner;

websocket = new WebSocket("ws://localhost:8765/");

websocket.onopen = () => {
    console.log("opened socket")
};

accepted_categories = ["PerformanceAndAnalytics", "PreferencesAndFunctionnality"]

websocket.onmessage = (event) => {
    data = JSON.parse(event.data)
    if (accepted_categories.includes(data.category)) {
        label = document.querySelector("#"+data.id)
        parent = label.parentNode.querySelector(".ot-tgl");
        if (parent == null || parent == undefined) {
            return
        }
        button = parent.childNodes[0]
        if (button != undefined) {
            button.click();
        }
    }
};

const unfold = function(element) {
    let flattened = [];
    let children = Array(...element.childNodes);
    let tmp = [];
    flattened.push(...children);
    while (children.length != 0) {
        tmp = [];
        for (child of children) {
            //console.log(child)
            if (child.childNodes != null) {
                tmp.push(...child.childNodes);
            }
        }
        flattened.push(...tmp);
        children = tmp;
    }
    return flattened;
};

document.addEventListener('DOMContentLoaded', () => {
    let banner;
    let clicked = [];
    setTimeout(() => {
        banner = document.querySelector(".onetrust-consent-sdk, #onetrust-consent-sdk");
        //console.log(banner);
        // banner contient la bannière détectée
        for (item of unfold(banner)) {
            if (item.textContent == "Adjust settings") {
                try {item.click();}
                catch {}
            }
        }
        banner = document.querySelector(".onetrust-consent-sdk, #onetrust-consent-sdk");
        potentials = banner.querySelectorAll(".ot-cat-header")
        
        // console.log(potentials)

        for (label of potentials) {
            // console.log(label.id)
            websocket.send(JSON.stringify({"id":label.id, "text": label.textContent}));
            // console.log(label.textContent)
        }
        
        // for (item of unfold(banner)) {
        //     clicked = [];
        //     if (item.nodeName == "SPAN") {
        //         websocket.send(item.textContent);
        //         websocket.onmessage = (event) => {
        //             if (accepted_categories.includes(event.data)) {
        //                 if (clicked.includes(item.parentNode) == false) {
        //                     item.parentNode.click();
        //                     clicked.push(item.parentNode);
        //                 }
        //             }
        //         };
                // console.log(item.nodeName);
                // console.log(item.parentNode);
                // if (clicked.includes(item.parentNode) == false) {
                //     item.parentNode.click();
                //     clicked.push(item.parentNode);
                // }
                // for (el of item.parentNode.childNodes) {
                //     try 
                //     {
                //         //if (clicked.includes(el) == false) {
                //         //    el.click();
                //         clicked.push(el);
                //         //}
                //     }
                //     catch {}
                // }
            // }
            
            //if (item.className == "ot-switch-nob") {
            //    console.log(item.parentNode);
            //    item.click();
            //}
        // }
    }, 5000);
});